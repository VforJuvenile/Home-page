!function(){var e=angular.module("wf.dragSort",[]);e.factory("node",["$document",function(e){return{getNodeHasAttribute:function(t,r){for(;t!==e[0].documentElement&&(!t.hasAttribute(r)||"false"===t.getAttribute(r));)t=t.parentNode;return t},getOffset:function(e){for(var t=0,r=0;null!==e;)t+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{oLeft:t,oTop:r}},getIndexFormParent:function(e){for(var t=e.parentNode,r=t.childNodes,n=r.length,o=0;n>o&&r[o]!=e;o++);return o},getChildNodesArrHasAttribute:function(e,t){for(var r=e.firstElementChild,n=[];r;)r.hasAttribute(t)&&"false"!==r.getAttribute(t)&&n.push(r),r=r.nextElementSibling;return n},updateLayout:function(e,t,r){var n=this.getIndexFormParent(e),o=this.getIndexFormParent(t),a=[],i=[];if(a=this.getChildNodesArrHasAttribute(e,r),i=this.getChildNodesArrHasAttribute(t,r),o>n){if(!(i.length>0))return!1;e.appendChild(i[0])}else e.insertBefore(i[i.length-1],e.firstElementChild);return!0}}}]).directive("mainDragContainer",["node","$document",function(e,t){return{restrict:"A",link:function(r,n,o){function a(r){l=r.target||r.srcElement,s=setTimeout(function(){n[0].addEventListener("mousemove",function(e){var t=e||window.event;t.preventDefault(),i(t)}),l=e.getNodeHasAttribute(l,"dragItem"),l!=t[0].documentElement&&(T.dragStart.call(l),u=l.parentNode,v=l.offsetLeft,A=l.offsetTop,H=!0,g=e.getOffset(l),p=g.oLeft-l.offsetLeft,c=g.oTop-l.offsetTop,m=r.pageX-g.oLeft,h=r.pageY-g.oTop,N=l.cloneNode(!0),N.innerHTML=".",l.parentNode.insertBefore(N,l),N.classList.toggle("dragPlace"),b=l.cloneNode(!0),l.parentNode.appendChild(b),L=l,l.setAttribute("dragItem","false"),l.classList.toggle("dragHide"),b.style.cssText+="position:absolute;left:"+v+"px;top:"+A+"px;",b.setAttribute("dragItem","false"),b.classList.toggle("drag"))},2e3)}function i(n){if(H){if(l=n.target,l=t[0].elementFromPoint(n.pageX,n.pageY),l.style.cursor="pointer",x=n.pageX-p-m,I=n.pageY-c-h,b.style.left=x+"px",b.style.top=I+"px",f=e.getNodeHasAttribute(l,"dragContainer"),l.hasAttribute("dragContainer")){var o=!0;return void(f!==u&&(T.allowFluid&&(o=e.updateLayout(u,f,"dragItem")),o&&(C=e.getChildNodesArrHasAttribute(f,"dragItem"),0===C.length?f.insertBefore(N,f.firstChild):f.insertBefore(N,C[C.length-1].nextSibling),u=f)))}l=e.getNodeHasAttribute(l,"dragItem"),l==t[0].documentElement||(f=l.parentNode,f!==u?(T.allowFluid&&e.updateLayout(u,f,"dragItem"),u=f,C=e.getChildNodesArrHasAttribute(f,"dragItem"),0===C.length?f.insertBefore(N,f.firstChild):f.insertBefore(N,C[C.length-1].nextSibling)):(w=e.getIndexFormParent(l),E=e.getIndexFormParent(N),E>w?l.parentNode.insertBefore(N,l):l.parentNode.insertBefore(N,l.nextSibling)),T.dragging.call(l))}r.$apply()}function d(e){clearTimeout(s),H&&(N.parentNode.insertBefore(L,N),L.classList.toggle("dragHide"),L.setAttribute("dragItem","true"),N.parentNode.removeChild(N),H=!1,n[0].addEventListener("mousemove",null),b.parentNode.removeChild(b),T.dragEnd.call(L))}var s,l,u,f,g,p,c,m,h,v,A,N,b,L,C,x,I,w,E,H=!1,T={dragStart:function(){},dragging:function(){},dragEnd:function(){},waitTime:1e3,allowFluid:!0};r.$watch(o.mainDragContainer,function(e,t){angular.extend(T,e)}),n[0].addEventListener("mousedown",function(e){var t=e||window.event;t.preventDefault(),a(t)}),n[0].addEventListener("mouseup",function(e){var t=e||window.event;t.preventDefault(),d(t)})}}}])}();